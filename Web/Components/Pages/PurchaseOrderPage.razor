@page "/purchaseOrder"
@rendermode InteractiveServer
<PageTitle>Purchase Order</PageTitle>
<div class="order-document">
    <EditForm Model="supplierModel" OnValidSubmit="OnCreate" FormName="AddPurchaseOrder">
        <DataAnnotationsValidator/>

        <h4>Order Document</h4>
        @foreach (var sectionItem in sectionItems)
        {
            <div class="section">
                <button type="button" class="toggle-button" @onclick="() => ToggleSection(sectionItem)" aria-label="@($"Toggle {sectionItem.Title} section")">
                    @GetSectionIcon(sectionItem.IsVisible)
                </button>
                <span class="section-title">@sectionItem.Title</span>
                @if (sectionItem.IsVisible)
                {
                    <div class="section-content">

                        @if (sectionItem.Title == "Definition of the economic operator")
                        {
                            <div class="input">
                                <div class="commend-input">
                                    <label>Choose a Supplier</label>
                                    <select id="supplierExists" @onchange="OnSupplierSelected">
                                        <option value="0" selected disabled>Select a Supplier</option>
                                        @foreach (var supplier in suppliers)
                                        {
                                            <option value="@supplier.ID">@supplier.SupplierName</option>
                                        }
                                    </select>
                                   
                                    <button type="button" class="addsupplier-button" @onclick="() => supplierSelector.ShowModal()"><i class="bi bi-person-plus"></i>  Add a Supplier</button>
                                </div>
                            </div>

                            @if (SupplierSelected)
                            {
                                <div class="input2">
                                    <div class="commend-input">
                                        <label for="firstName">Full Name</label>
                                        <InputText id="firstName" @bind-Value="supplierModel.NameSupplier" class="input-field" disabled/>
                                    </div>

                                    <div class="commend-input">
                                        <label for="companyName">Or Company Name (Legal form determination)</label>
                                        <InputText id="companyName" @bind-Value="supplierModel.NameCompany" class="input-field" disabled/>
                                    </div>
                                </div>
                                <div class="input2">

                                    <div class="commend-input">
                                        <label for="actsOnBehalf">Acts on Behalf of</label>
                                        <InputText id="actsOnBehalf" @bind-Value="supplierModel.NameAccount" class="input-field"/>
                                    </div>

                                    <div class="commend-input">
                                        <label for="operatorAddress">Address</label>
                                        <InputText id="operatorAddress" @bind-Value="supplierModel.Address" class="input-field" disabled/>
                                    </div>
                                </div>
                                <div class="input2">
                                    <div class="commend-input">
                                        <label for="email">Email</label>
                                        <InputText id="email" @bind-Value="supplierModel.Email" class="input-field" disabled/>
                                    </div>

                                    <div class="commend-input">
                                        <label for="operatorContact">Phone</label>
                                        <InputText id="operatorContact" @bind-Value="supplierModel.Phone" class="input-field" disabled/>
                                    </div>
                                </div>
                            }
                        }
                        @if (sectionItem.Title == "Characteristics of the order")
                        {
                            <div class="card p-4 shadow-sm">
                                <div class="container">
                                    <div class="input-titel">
                                        <label>Select your Services</label>
                                    </div>
                                    <div class="radio-group">
                                        <InputRadioGroup @bind-Value="OrderService">
                                            <div class="input-container">
                                                <InputRadio Value="s1"/> Works
                                            </div>
                                            <div class="input-container">
                                                <InputRadio Value="s2"/> Equipment
                                            </div>
                                            <div class="input-container">
                                                <InputRadio Value="s3"/> Services
                                            </div>
                                        </InputRadioGroup>
                                    </div> <br/>
                                        <div class="container">
                                            <div class="input-titel">
                                                <label>Select your Budget</label>
                                            </div>
                                    <div class="radio-group">
                                        <InputRadioGroup @bind-Value="OrderCategory">
                                            <div class="input-container">
                                                <InputRadio Value="bg1"/> Operating Expenses
                                            </div>
                                            <div class="input-container">
                                                <InputRadio Value="bg2"/> Equipment Expenses
                                            </div>
                                            <div class="input-container">
                                                <InputRadio Value="bg3"/> Other Expenses
                                            </div>
                                        </InputRadioGroup>
                                    </div>
                                    </div>
                                </div>


                                <div class="input2">
                                       <div class="commend-input">
                                           <label>Choose a Chapter</label>
                                       <InputSelect class="input-field" @bind-Value="SelectedChapter">
                                           <option disabled selected>Select a Chapter</option>
                                           <option value="25">25</option>
                                           <option value="26">26</option>
                                           <option value="27">27</option>
                                           <option value="28">28</option>
                                       </InputSelect>
                                   </div>
                                      <div class="commend-input">
                                        <label>Choose an Article</label>
                                        <InputSelect class="input-field" @bind-Value="SelectedArticle">
                                            <option disabled selected>Select an Article</option>
                                            <option value="40">40</option>
                                            <option value="41">41</option>
                                            <option value="42">42</option>
                                            <option value="43">43</option>
                                        </InputSelect>
                                        </div>
                                    <div class="commend-input">
                                        <label for="description">Description Article</label>
                                        <InputTextArea id="description" @bind-Value="supplierModel.NameSupplier" style="margin-top: 4px"  placeholder="Enter Description" class="form-control valid"/>
                                    </div> </div>
                                

                                <div style="max-height: 300px; overflow-y: auto;">
                                    <table class="table table-bordered mt-3 text-center">
                                        <thead class="table-light">
                                        <tr>
                                            <th style="width: 3%;">Number</th>
                                            <th style="width: 40%;">Data</th>
                                            <th style="width: 4%;">Unit of Measure</th>
                                            <th style="width: 7%;">Quantity</th>
                                            <th style="width: 15%;">Unit Price</th>
                                            <th style="width: 9%;">TVA</th>
                                            <th style="width: 18%;">Total</th>
                                            <th style="width: 2%;">Actions</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        @foreach (var product in products)
                                        {
                                            <tr>
                                                <td>
                                                    <InputNumber class="form-control" @bind-Value="product.Number" disabled/>
                                                </td>
                                                <td>
                                                    <InputTextArea class="form-control" @bind-Value="product.Data"/>
                                                </td>
                                                <td>
                                                    <InputText class="form-control" @bind-Value="product.UnitOfMeasure"/>
                                                </td>
                                                <td>
                                                    <InputNumber class="form-control" @bind-Value="product.Quantity" min=1 />
                                                </td>
                                                <td>
                                                    <InputNumber class="form-control" @bind-Value="product.UnitPrice" min=1 />
                                                </td>

                                                <td>
                                                    <InputSelect class="form-control text-center valid" @bind-Value="product.TVA">
                                                        <option value="0">0%</option>
                                                        <option value="9" >9%</option>
                                                        <option value="19" selected>19%</option>
                                                    </InputSelect>

                                                </td>
                                                <td>
                                                    <InputNumber class="form-control" @bind-Value="product.UnitPrice" min=1 disabled/>
                                                </td>
                                                <td>
                                                    <button type="button" class="deleteproduct-button text-center" @onclick="() => DeleteProduct(product)">
                                                        <i class="bi bi-trash-fill"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        }
                                        </tbody>
                                    </table>
                                </div>

                                <div class="container2">

                                    <div class="btn-add-product">
                                        <button type="button" class="addproduct-button" @onclick="AddProduct">
                                            <i class="bi bi-plus-circle"></i>  Add a product
                                        </button>
                                    </div>
                                </div>

                                <br/>
                                <p>The economic operator is obligated to fulfill this order according to the specified conditions.</p>
                                <p>
                                    The delivery or execution time is estimated at:
                                    <InputNumber id="delivery_time" @bind-Value="DeliveryTime" class="input-field delivery-time" min=1 /> days
                                </p>
                            </div>
                        }
                    </div>
                }
            </div>
        }

        <button type="submit" class="create-button">Create</button>
    </EditForm>
</div>
<ToastValidation Type="toastType" Title="@toastTitle" Message="@toastMessage" IsVisible="isToastVisible"
                 OnClose="CloseToast"/>
<SupplierSelector @ref="supplierSelector" />